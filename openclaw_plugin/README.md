# Open Safe Frame - OpenClaw Plugin

**新范式：权限开放，约束内置**

基于真实安全事故案例设计，采用全新的安全架构：意图理解 → 后果预测 → 价值判断 → 协同决策

## 核心理念

```
传统方法: 规则检测 → 阻止/放行
新范式: 意图理解 → 后果预测 → 价值判断 → 协同决策
```

**设计原则**：
- 如非必要，不打扰用户
- 需要确认时，提供完整信息（意图、操作、后果、严重程度）
- 二次确认机制（密码或明确确认）

## 安装

```bash
# 通过ClawHub安装
npx clawhub@latest install open-safe-frame

# 或手动安装
npm install @open-safe-frame/openclaw-plugin
```

## 架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户指令                                  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    意图理解引擎                                  │
│         理解用户真正想要什么，而非表面指令                        │
│         • 提取核心意图                                           │
│         • 识别约束条件                                           │
│         • 分析涉及的数据类型和规模                               │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    后果预测引擎                                  │
│         预测操作的可能后果，评估严重程度                          │
│         • 数据丢失风险                                           │
│         • 财务风险                                               │
│         • 隐私风险                                               │
│         • 系统风险                                               │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    价值判断引擎                                  │
│         判断是否符合用户利益                                      │
│         • 数据安全 (权重: 1.0)                                   │
│         • 财务安全 (权重: 0.95)                                  │
│         • 隐私保护 (权重: 0.9)                                   │
│         • 意图一致性 (权重: 0.85)                                │
│         • 可逆性 (权重: 0.7)                                     │
└─────────────────────────────────────────────────────────────────┘
                              │
              ┌───────────────┼───────────────┐
              ▼               ▼               ▼
        ┌──────────┐   ┌──────────┐   ┌──────────┐
        │ 低风险    │   │ 中风险    │   │ 高风险    │
        │ 直接执行  │   │ 记录日志  │   │ 用户确认  │
        └──────────┘   └──────────┘   └──────────┘
```

## 确认请求示例

当检测到高风险操作时，用户会收到详细的确认请求：

```
══════════════════════════════════════════════════
🔐 Open Safe Frame - 操作确认请求
══════════════════════════════════════════════════

【AI理解的意图】
批量删除邮件操作

【要执行的操作】
执行: 批量删除邮件操作
具体操作: 删除邮件, 数量: 200
涉及数据: 邮件数据(large)

【可能的后果】
  🔴 批量/递归删除操作可能导致大量数据永久丢失 ⚠️不可逆
  🟠 删除操作可能导致数据丢失，包括可能重要的邮件通信记录

【严重程度】🔴 严重风险

🔑 此操作需要输入密码确认

请输入您的确认密码以继续：

══════════════════════════════════════════════════
```

## 与传统规则引擎的区别

| 传统方法 | Open Safe Frame |
|----------|-----------------|
| 关键词匹配 | 意图理解 |
| 静态规则 | 动态评估 |
| 简单阻止/放行 | 协同决策 |
| 用户不知道为什么被阻止 | 详细解释意图、操作、后果 |
| 限制AI权限 | AI有完全权限，但有内在约束 |

## 基于真实案例设计

### 案例1：Meta安全高管邮件被删光
**问题**：OpenClaw无视"未经批准不得操作"指令，删除200+封邮件

**解决方案**：
- 意图理解引擎识别"整理邮件"≠"删除所有邮件"
- 后果预测引擎检测到批量删除风险
- 价值判断引擎评估用户利益受损
- 触发用户确认，详细说明后果

### 案例2：Google Antigravity删库事故
**问题**：路径包含空格导致解析截断，误删整个E盘

**解决方案**：
- 后果预测引擎检测路径空格风险
- 识别递归删除命令的危险性
- 价值判断引擎评估不可逆性
- 触发严重风险确认（需密码）

### 案例3：OpenClaw强买牛油果酱
**问题**：AI无视用户拒绝，自主决定购买

**解决方案**：
- 意图理解引擎检测用户意图与操作不匹配
- 价值判断引擎评估财务安全价值
- 触发确认或直接阻止

## 配置

在 `openclaw.json` 中添加配置：

```json
{
  "plugins": {
    "entries": {
      "open-safe-frame": {
        "config": {
          "enabled": true
        }
      }
    }
  }
}
```

## 许可证

MIT License
