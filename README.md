# Open Safe Frame

**权限开放，约束内置** - OpenClaw安全插件

## 核心理念

```
传统方法: 规则检测 → 阻止/放行
新范式: 意图理解 → 后果预测 → 价值判断 → 协同决策
```

**设计原则**：
- 如非必要，不打扰用户
- 需要确认时，提供完整信息（意图、操作、后果、严重程度）
- 二次确认机制（密码或明确确认）

## 项目来历

2026年2月，AI圈发生多起安全事故：

| 事件 | 详情 |
|------|------|
| **Meta安全高管邮件被删光** | OpenClaw无视"未经批准不得操作"指令，删除200+封邮件 |
| **Google Antigravity删库** | 路径包含空格导致解析截断，误删整个E盘 |
| **OpenClaw强买牛油果酱** | AI无视用户拒绝，自主决定购买 |

这些事故揭示了一个核心问题：**如何在赋予AI充分能力的同时，确保其行为安全可控？**

本项目采用全新范式：不是外部约束，而是内在的对齐。

## 架构

```
用户指令
    │
    ▼
┌─────────────────────────────────────────────────────────────────┐
│                    意图理解引擎                                  │
│         • 提取核心意图（区分"整理邮件"和"删除所有邮件"）          │
│         • 识别约束条件（"不要删除"、"仅查看"）                    │
│         • 分析涉及的数据类型和规模                               │
└─────────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────────┐
│                    后果预测引擎                                  │
│         • 数据丢失风险（不可逆性评估）                           │
│         • 财务风险（未授权购买）                                 │
│         • 隐私风险（敏感数据外泄）                               │
│         • 系统风险（危险命令、路径截断）                         │
└─────────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────────┐
│                    价值判断引擎                                  │
│         • 数据安全 (权重: 1.0)                                   │
│         • 财务安全 (权重: 0.95)                                  │
│         • 隐私保护 (权重: 0.9)                                   │
│         • 意图一致性 (权重: 0.85)                                │
│         • 可逆性 (权重: 0.7)                                     │
└─────────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────────┐
│                    决策引擎                                      │
│         • 低风险 → 直接执行（不打扰用户）                        │
│         • 中风险 → 记录日志 + 可能确认                           │
│         • 高风险 → 用户确认（详细说明意图、操作、后果、严重程度） │
│         • 严重风险 → 密码确认                                    │
└─────────────────────────────────────────────────────────────────┘
```

## 安装

```bash
# 通过ClawHub安装
npx clawhub@latest install open-safe-frame

# 或手动安装
npm install @open-safe-frame/openclaw-plugin
```

## 配置

在 `openclaw.json` 中添加：

```json
{
  "plugins": {
    "entries": {
      "open-safe-frame": {
        "config": {
          "enabled": true
        }
      }
    }
  }
}
```

## 确认请求示例

当检测到高风险操作时：

```
══════════════════════════════════════════════════
🔐 Open Safe Frame - 操作确认请求
══════════════════════════════════════════════════

【AI理解的意图】
批量删除邮件操作

【要执行的操作】
执行: 批量删除邮件操作
具体操作: 删除邮件, 数量: 200
涉及数据: 邮件数据

【可能的后果】
  🔴 批量/递归删除操作可能导致大量数据永久丢失 ⚠️不可逆
  🟠 删除操作可能导致数据丢失，包括可能重要的邮件通信记录

【严重程度】🔴 严重风险

🔑 此操作需要输入密码确认

══════════════════════════════════════════════════
```

## 与传统方法的区别

| 传统方法 | Open Safe Frame |
|----------|-----------------|
| 关键词匹配 | 意图理解 |
| 静态规则 | 动态评估 |
| 简单阻止/放行 | 协同决策 |
| 用户不知道为什么被阻止 | 详细解释意图、操作、后果 |
| 限制AI权限 | AI有完全权限，但有内在约束 |

## 项目结构

```
openclaw_plugin/
├── src/
│   ├── index.ts              # 插件主入口
│   ├── types.ts              # 类型定义
│   └── core/
│       ├── types.ts          # 核心类型
│       ├── intent_engine.ts  # 意图理解引擎
│       ├── consequence_engine.ts  # 后果预测引擎
│       ├── value_engine.ts   # 价值判断引擎
│       ├── decision_engine.ts  # 决策引擎
│       └── coordinator.ts    # 协调器
├── package.json
├── tsconfig.json
├── openclaw.plugin.json
└── README.md
```

## 许可证

MIT License
